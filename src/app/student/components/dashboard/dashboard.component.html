<div class="p-6 bg-white dark:bg-slate-200 min-h-screen">
  <div class="max-w-7xl mx-auto">
    <!-- Header with welcome message -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-black">Student Dashboard</h1>
      <p class="text-slate-700 dark:text-slate-700 mt-2">
        Welcome back! Here's your learning progress at a glance.
      </p>
    </div>

    <!-- Stat Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <!-- Progress Card -->
      <div
        class="min-h-[250px] transform transition-all duration-300 hover:scale-105"
      >
        <p-card
          [style]="{ height: '90%', overflow: 'hidden' }"
          class="border-l-4 border-emerald-500 shadow-lg rounded-lg"
          *ngIf="!loading"
        >
          <ng-template #header>
            <div
              class="flex justify-between items-center p-4 bg-emerald-50 dark:bg-emerald-900/30"
            >
              <i class="pi pi-chart-line text-2xl text-emerald-500"></i>
              <div class="text-right">
                <span class="text-sm text-slate-700 dark:text-slate-700"
                  >Overall</span
                >
              </div>
            </div>
          </ng-template>
          <ng-template #title>Course Progress</ng-template>
          <ng-template #subtitle>
            <div class="flex items-center">
              <span
                class="text-2xl font-bold text-emerald-600 dark:text-emerald-400"
                >{{ progress }}%</span
              >
              <p-progressBar
                [value]="50"
                styleClass="h-2 ml-4"
                [showValue]="false"
              ></p-progressBar>
            </div>
          </ng-template>
        </p-card>

        <!-- Skeleton for Progress Card -->
        <div
          class="border-l-4 border-emerald-500 shadow-lg bg-white rounded-lg overflow-hidden"
          *ngIf="loading"
        >
          <div class="p-4 bg-emerald-50 dark:bg-emerald-900/30">
            <p-skeleton
              width="2rem"
              height="5rem"
              styleClass="mb-2"
            ></p-skeleton>
          </div>
          <div class="p-4">
            <p-skeleton
              width="60%"
              height="1.5rem"
              styleClass="mb-2"
            ></p-skeleton>
            <div class="flex items-center mt-2">
              <p-skeleton width="3rem" height="2rem"></p-skeleton>
              <p-skeleton
                width="70%"
                height="0.5rem"
                styleClass="ml-4"
              ></p-skeleton>
            </div>
          </div>
        </div>
      </div>

      <!-- Upcoming Quizzes Card -->
      <div class="transform transition-all duration-300 hover:scale-105">
        <p-card
          routerLink="/students/quiz-home"
          [style]="{ height: '90%', overflow: 'hidden', cursor: 'pointer' }"
          class="border-l-4 border-blue-500 shadow-lg rounded-lg"
          *ngIf="!loading"
        >
          <ng-template #header>
            <div
              class="flex justify-between items-center p-4 bg-blue-50 dark:bg-blue-900/30"
            >
              <i class="pi pi-calendar-plus text-2xl text-blue-500"></i>
              <div class="text-right">
                <span class="text-sm text-slate-700 dark:text-slate-700"
                  >This Week</span
                >
              </div>
            </div>
          </ng-template>
          <ng-template #title>Quiz Stats</ng-template>
          <ng-template #subtitle>
            <div class="flex flex-col justify-center">
              <span class="text-xl text-slate-700 dark:text-slate-700"
                >Total Quizzes
                <span
                  class="ml-2 text-2xl font-bold text-blue-600 dark:text-blue-400"
                  >{{ totalQuizzNumber }}</span
                >
              </span>

              <span class="text-xl text-slate-700 dark:text-slate-700"
                >Completed
                <span
                  class="ml-2 text-2xl font-bold text-blue-600 dark:text-blue-400"
                  >{{ completedQuizNumber }}</span
                ></span
              >
            </div>
          </ng-template>
          <ng-template #footer>
            <div class="text-right">
              <span
                class="text-sm text-blue-500 hover:text-blue-700 flex items-center justify-end"
              >
                View Schedule <i class="pi pi-arrow-right ml-2"></i>
              </span>
            </div>
          </ng-template>
        </p-card>

        <!-- Skeleton for Upcoming Quizzes Card -->
        <div
          class="border-l-4 border-blue-500 shadow-lg rounded-lg bg-white overflow-hidden"
          *ngIf="loading"
        >
          <div class="p-4 bg-blue-50 dark:bg-blue-900/30">
            <p-skeleton
              width="2rem"
              height="2rem"
              styleClass="mb-2"
            ></p-skeleton>
          </div>
          <div class="p-4">
            <p-skeleton
              width="70%"
              height="2rem"
              styleClass="mb-2"
            ></p-skeleton>
            <div class="flex items-center mt-2">
              <p-skeleton width="2rem" height="2rem"></p-skeleton>
              <p-skeleton
                width="40%"
                height="1rem"
                styleClass="ml-2"
              ></p-skeleton>
            </div>
          </div>
          <div class="p-4 flex justify-end">
            <p-skeleton width="30%" height="1rem"></p-skeleton>
          </div>
        </div>
      </div>

      <!-- Leaderboard Position Card -->
      <div
        class="min-h-[250px] transform transition-all duration-300 hover:scale-105"
      >
        <p-card
          routerLink="/students/leaderboard"
          class="border-l-4 border-purple-500 shadow-lg rounded-lg cursor-pointer"
          *ngIf="!loading"
        >
          <ng-template #header>
            <div
              class="flex justify-between items-center p-4 bg-purple-50 dark:bg-purple-900/30"
            >
              <i class="pi pi-star text-2xl text-purple-500"></i>
              <div class="text-right">
                <span class="text-sm text-slate-700 dark:text-slate-700"
                  >Your Rank</span
                >
              </div>
            </div>
          </ng-template>
          <ng-template #title>Leaderboard Position</ng-template>
          <ng-template #subtitle>
            <div class="flex flex-col justify-enditems-center">
              <span
                class="text-3xl font-bold text-purple-600 dark:text-purple-400"
              >
                {{ currentUserRank?.rank }}
              </span>

              <span class="ml-2 text-sm text-slate-700 dark:text-slate-700"
                >with total points
                <span
                  class="text-xl font-bold text-purple-600 dark:text-purple-400"
                  >{{ currentUserRank?.total_points }}</span
                >
              </span>
            </div>
          </ng-template>
          <ng-template #footer>
            <div class="text-right">
              <span
                class="text-sm text-purple-500 hover:text-purple-700 flex items-center justify-end"
              >
                View Leaderboard <i class="pi pi-arrow-right ml-2"></i>
              </span>
            </div>
          </ng-template>
        </p-card>

        <!-- Skeleton for Leaderboard Position Card -->
        <div
          class="border-l-4 border-purple-500 shadow-lg rounded-lg bg-white overflow-hidden"
          *ngIf="loading"
        >
          <div class="p-4 bg-purple-50 dark:bg-purple-900/30">
            <p-skeleton
              width="2rem"
              height="2rem"
              styleClass="mb-2"
            ></p-skeleton>
          </div>
          <div class="p-4">
            <p-skeleton
              width="80%"
              height="1.5rem"
              styleClass="mb-2"
            ></p-skeleton>
            <div class="flex items-center mt-2">
              <p-skeleton width="2rem" height="2rem"></p-skeleton>
              <p-skeleton
                width="60%"
                height="1rem"
                styleClass="ml-2"
              ></p-skeleton>
            </div>
          </div>
          <div class="p-4 flex justify-end">
            <p-skeleton width="40%" height="1rem"></p-skeleton>
          </div>
        </div>
      </div>
      <div class="transform transition-all duration-300 hover:scale-105">
        <p-card
          routerLink="/students/forums"
          [style]="{ height: '90%', overflow: 'hidden', cursor: 'pointer' }"
          class="border-l-4 border-yellow-500 shadow-lg rounded-lg"
          *ngIf="!loading"
        >
          <ng-template #header>
            <div
              class="flex justify-between items-center p-4 bg-blue-50 dark:bg-yellow-900/30"
            >
              <i class="pi pi-comments text-2xl text-yellow-500"></i>
              <div class="text-right">
                <span class="text-sm text-slate-700 dark:text-slate-700"
                  >Engage with Peers</span
                >
              </div>
            </div>
          </ng-template>
          <ng-template #title>Forum Activity</ng-template>
          <ng-template #subtitle>
            <div class="flex items-center">
              <span
                class="text-2xl font-bold text-yellow-600 dark:text-yellow-400"
                >{{ forumCount }}</span
              >
              <span class="ml-2 text-sm text-slate-700 dark:text-slate-700"
                >new discussions this week</span
              >
            </div>
          </ng-template>
          <ng-template #footer>
            <div class="text-right">
              <span
                class="text-sm text-yellow-500 hover:text-yellow-700 flex items-center justify-end"
              >
                Participate in Discussions
                <i class="pi pi-arrow-right ml-2"></i>
              </span>
            </div>
          </ng-template>
        </p-card>

        <!-- Skeleton for Leaderboard Position Card -->
        <div
          class="border-l-4 border-yellow-500 shadow-lg rounded-lg bg-white overflow-hidden"
          *ngIf="loading"
        >
          <div class="p-4 bg-purple-50 dark:bg-yellow-900/30">
            <p-skeleton
              width="2rem"
              height="2rem"
              styleClass="mb-2"
            ></p-skeleton>
          </div>
          <div class="p-4">
            <p-skeleton
              width="80%"
              height="1.5rem"
              styleClass="mb-2"
            ></p-skeleton>
            <div class="flex items-center mt-2">
              <p-skeleton width="2rem" height="2rem"></p-skeleton>
              <p-skeleton
                width="60%"
                height="1rem"
                styleClass="ml-2"
              ></p-skeleton>
            </div>
          </div>
          <div class="p-4 flex justify-end">
            <p-skeleton width="40%" height="1rem"></p-skeleton>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Quizzes -->
    <div class="mb-8">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold text-black">Recent Quizzes</h2>

        <p-skeleton width="8rem" height="2.5rem" *ngIf="loading"></p-skeleton>
      </div>
      <div
        class="bg-white dark:bg-slate-800 rounded-xl shadow-md overflow-hidden"
      >
        <!-- Actual data table -->
        <p-table
          [value]="recentQuizzes"
          [tableStyle]="{ 'min-width': '50rem' }"
          styleClass="p-datatable-sm bg-white"
          [rows]="5"
          *ngIf="!loading"
        >
          <ng-template #header>
            <tr>
              <th class="text-slate-600 dark:text-slate-300">Quiz Name</th>
              <th class="text-slate-600 dark:text-slate-300">Score</th>
              <th class="text-slate-600 dark:text-slate-300">Date</th>
              <th class="text-slate-600 dark:text-slate-300">View Quiz</th>
            </tr>
          </ng-template>
          <ng-template #body let-quizz>
            <tr class="hover:bg-slate-50 dark:hover:bg-slate-700">
              <td class="text-slate-700 dark:text-slate-300 font-medium">
                {{ quizz.name }}
              </td>
              <td>
                <span
                  [ngClass]="{
                    'text-green-600 dark:text-green-400': quizz.score > 70,
                    'text-yellow-600 dark:text-yellow-400':
                      quizz.score >= 50 && quizz.score <= 70,
                    'text-red-600 dark:text-red-400': quizz.score < 50
                  }"
                  class="font-semibold"
                >
                  {{ quizz.score }}%
                </span>
              </td>
              <td class="text-slate-600 dark:text-slate-400">
                {{ quizz.date }}
              </td>
              <td>
                <p-button
                  icon="pi pi-eye"
                  variant="outlined"
                  label=""
                  (click)="showQuizResult(quizz.quizId)"
                ></p-button>
              </td>
            </tr>
          </ng-template>
          <ng-template #emptymessage>
            <tr>
              <td colspan="4" class="text-center p-6">
                <div class="flex flex-col items-center">
                  <i class="pi pi-inbox text-4xl text-slate-300 mb-4"></i>
                  <span class="text-slate-500">No quizzes completed yet</span>
                  <p-button
                    label="Take a Quiz"
                    styleClass="p-button-sm mt-3"
                    routerLink="/students/quiz-home"
                  ></p-button>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>

        <!-- Skeleton for table -->
        <div class="p-4" *ngIf="loading"  class="bg-slate-200">
          <p-skeleton height="2rem" styleClass="mb-2"></p-skeleton>
          <p-skeleton height="3.5rem" styleClass="mb-2"></p-skeleton>
          <p-skeleton height="3.5rem" styleClass="mb-2"></p-skeleton>
          <p-skeleton height="3.5rem" styleClass="mb-2"></p-skeleton>
          <p-skeleton height="3.5rem" styleClass="mb-2"></p-skeleton>
          <p-skeleton height="3.5rem" styleClass="mb-2"></p-skeleton>
          <div class="flex justify-center mt-4">
            <p-skeleton width="50%" height="2rem"></p-skeleton>
          </div>
        </div>
      </div>
    </div>

    <!-- Achievements & Badges -->
    <div class="mb-10">
      <div class="flex justify-between items-center mb-20">
        <h2 class="text-2xl font-bold text-black">Achievements & Badges</h2>

        <p-skeleton width="8rem" height="2.5rem" *ngIf="loading"></p-skeleton>
      </div>
      <h2
        *ngIf="!(badges.length > 0)"
        class="text-2xl text-center font-light text-slate-500 tracking-widest"
      >
        <span class="border p-4 rounded-xl">Do a Quiz To Earn Badges</span>
      </h2>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Actual badge cards -->
        @for (badge of badges; track badge.id) {
        <div>
          <div
            *ngIf="!loading"
            class="border border-transparent transform transition-all duration-300 hover:border-green-500 rounded-lg"
          >
            <p-card
              class="badge-card transform transition-all duration-300 rounded-xl overflow-hidden hover:scale-105 hover:shadow-2xl dark:bg-slate-800 border-0"
            >
              <!-- Header with improved background and positioning -->
              <ng-template pTemplate="header">
                <div
                  class="relative h-40 flex items-center justify-center overflow-hidden"
                >
                  <!-- Dynamic gradient background based on badge type -->
                  <div
                    class="absolute inset-0 bg-gradient-to-br"
                    [ngClass]="{
                      'from-blue-500 to-purple-600': badge.id === 'explorer',
                      'from-emerald-400 to-teal-600': badge.id === 'challenger',
                      'from-amber-400 to-orange-600': badge.id === 'mastermind'
                    }"
                    [style.opacity]="0.85"
                  ></div>

                  <!-- Decorative pattern overlay -->
                  <div class="absolute inset-0 opacity-10 bg-pattern"></div>

                  <!-- Badge image with highlight effect -->
                  <div
                    class="relative z-10 transform transition-transform duration-500 hover:rotate-3 hover:scale-110"
                  >
                    <div
                      class="absolute -inset-1 rounded-full bg-white dark:bg-slate-700 opacity-20 blur"
                    ></div>
                    <img
                      [src]="badge.image_url"
                      alt="{{ badge.name }}"
                      class="w-24 h-24 object-contain drop-shadow-lg"
                    />
                  </div>
                </div>
              </ng-template>

              <!-- Title with improved styling -->
              <ng-template pTemplate="title">
                <div class="flex items-center justify-center mt-2 pb-1">
                  <span class="font-bold text-xl text-black tracking-tight">
                    {{ badge.name }}
                  </span>
                  <i
                    class="pi pi-check-circle text-green-500 ml-2 animate-pulse"
                  ></i>
                </div>
              </ng-template>

              <!-- Subtitle with better readability -->
              <ng-template pTemplate="subtitle">
                <p
                  class="text-center text-slate-800 dark:text-slate-500 px-4 py-2 text-sm leading-relaxed"
                >
                  {{ badge.description }}
                </p>
              </ng-template>

              <!-- Adding a footer with badge metadata -->
              <ng-template pTemplate="footer">
                <div
                  class="px-4 py-3 flex justify-between items-center border-t border-slate-100 dark:border-slate-700"
                >
                  <div class="flex items-center">
                    <i class="pi pi-star-fill text-amber-400 mr-1"></i>
                    <span
                      class="text-xs font-medium text-slate-700 dark:text-slate-800"
                      >{{ badge.name }}</span
                    >
                  </div>
                </div>
              </ng-template>
            </p-card>
          </div>
        </div>

        }

        <!-- Skeleton badges -->
        @for (i of [1,2,3]; track i) {
        <div
          class="shadow-md rounded-lg overflow-hidden bg-white dark:bg-slate-800"
          *ngIf="loading"
        >
          <div
            class="h-16 flex items-center justify-center bg-gradient-to-r from-indigo-200 to-purple-200 dark:from-indigo-900 dark:to-purple-900"
          >
            <p-skeleton shape="circle" size="3rem"></p-skeleton>
          </div>
          <div class="p-4">
            <div class="flex items-center mb-2">
              <p-skeleton
                width="60%"
                height="1.5rem"
                styleClass="mr-2"
              ></p-skeleton>
              <p-skeleton shape="circle" size="1rem"></p-skeleton>
            </div>
            <p-skeleton
              width="100%"
              height="1rem"
              styleClass="mb-1"
            ></p-skeleton>
            <p-skeleton
              width="90%"
              height="1rem"
              styleClass="mb-1"
            ></p-skeleton>
            <p-skeleton
              width="40%"
              height="1rem"
              styleClass="mb-1"
            ></p-skeleton>
            <div class="flex justify-between items-center mt-4">
              <p-skeleton width="30%" height="0.75rem"></p-skeleton>
            </div>
          </div>
        </div>
        }
      </div>
    </div>
  </div>
</div>
